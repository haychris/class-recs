{% extends "base.html" %}
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

{% block content %}
    <div id="resultPrompt">
      Based on your past courses, we recommend...
    </div>
    <div id="editCourseHistButton" onclick="location.href='userratings'">
      Need to update your course/major info?<br/><br/>
    </div>

    {% for result in results %}
      <div class="result">

        <div class="resultName" onclick="showDiv{{loop.index}}()">
          <div class="resultCourseNumber">
              {{result.get_course_listings()}}
          </div>
          <div class="resultCourseNameContainer">
            <div class="resultCourseName">
              {{result.get_title()}}
            </div>
            <div class="resultExpand">
              (Details)
            </div>
          </div>
        </div>

        <div class="resultData">
          <div class="resultScoreData">
           <div id="starRating_{{loop.index}}" style="display:inline"></div>
           <div class="resultScore">
              {{result.get_default_term_text()}}: {{result.get_most_recent_overall_rating()}}
           </div>
          </div>
          <div class="resultComments">
           {{result.get_comments()[0]}}
          </div>
        </div>
      </div>
      <script> 
          text = "<font size='6px'>";
          rawScore = parseFloat({{result.get_most_recent_overall_rating()}});
          numstars = parseInt({{result.get_most_recent_overall_rating()}});
          halfStars = Math.round(rawScore - numstars);

          for (i = 0; i < numstars; i++) { 
            text += "<font color='gold'>★</font>"
          }
          for (i = 0; i < halfStars; i++) {
            text += "<font color='gold'>⋆</font>"
          }
          for (i = numstars+halfStars; i < 5; i++) { 
            text += "<font color='black'>☆</font>"
          } 
          text += "</font>";
          document.getElementById("starRating_{{loop.index}}").innerHTML = text; 
      </script>

      <div class="result" class="expandedResult" id="result_hidden_{{loop.index}}" style="display:none; margin-top:0; background:slateblue; height:150px">
        <div align="left" style="display:none">
          Lectures: {{result.get_all_ratings()[0]}}
        </div>
        <div align="left" style="display:none">
          Papers, Reports, Problem Sets, and Examinations: {{result.get_all_ratings()[1]}}
        </div>
        <div align="left" style="display:none">
          Readings: {{result.get_all_ratings()[2]}}
        </div>
        <div align="left" style="display:none">
          Classes: {{result.get_all_ratings()[3]}}
        </div>
        <div align="left" style="display:none">
          Overall Quality of the Course: {{result.get_all_ratings()[4]}}
        </div>
        <div id="chart_{{loop.index}}"></div>
<!--
        <div id="term_tags"> 
          <div style="display:inline">Fall '14</div>
          <div style="display:inline">Fall '15</div>
        </div>
-->
      </div>

      <script type="text/javascript">
      function showDiv{{loop.index}}() {
          div = document.getElementById('result_hidden_{{loop.index}}');
          if (div.style.display == "block")
            div.style.display = "none";
          else
            div.style.display = "block";
      } 
      </script>

      <script type="text/javascript">
    // google.charts.load("current", {packages:["corechart"]});
    google.charts.setOnLoadCallback(drawChart);
    function drawChart() {
      var data = google.visualization.arrayToDataTable([
        ["Element", "Rating", { role: "style" } ],
        ["Classes", parseFloat({{result.get_all_ratings()[0]}}), "#b87333"],
        ["Coursework & Exams", parseFloat({{result.get_all_ratings()[1]}}), "#b87333"],
        ["Readings", parseFloat({{result.get_all_ratings()[2]}}), "silver"],
        ["Classes", parseFloat({{result.get_all_ratings()[3]}}), "gold"],
        ["Overall Quality", parseFloat({{result.get_all_ratings()[4]}}), "color: #e5e4e2"]
      ]);

      var view = new google.visualization.DataView(data);
      view.setColumns([0, 1,
                       { calc: "stringify",
                         sourceColumn: 1,
                         type: "string",
                         role: "annotation" },
                       2]);

      var options = {
        title: "Most Recent Class Ratings for {{result.get_course_listings()}}",
        width: 800,
        height: 150,
        bar: {groupWidth: "55%"},
        chartArea: {left:150},
        legend: { position: "none" },
        hAxis: {
          minValue: 0,
          maxValue: 4,
          gridlines: { count: 6 }
        },
        backgroundColor: "slateblue"
      };
      var chart = new google.visualization.BarChart(document.getElementById("chart_{{loop.index}}"));
      chart.draw(view, options);
  }
  </script>
      
    {% else %}
      <p>No results.</p>
    {% endfor %}

    <div class="loadMoreButton" onclick="">Load More</div>
<!--    <div id="barchart_values" style="width: 900px; height: 300px;"></div>
-->
{% endblock content %}
